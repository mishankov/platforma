---
title: log
---
import { LinkButton, Steps } from '@astrojs/starlight/components';

The `log` package provides structured logging with automatic context value extraction for tracing and debugging.

Core Components:

- `Logger`: Default logger instance used by package-level logging functions.
- `New`: Creates a new `slog.Logger` with text or JSON output and custom context keys.
- `SetDefault`: Replaces the default logger used by package-level functions.
- `TraceIDKey`, `ServiceNameKey`, `WorkerIDKey`, etc.: Context keys automatically extracted into log output.
- `Debug`, `Info`, `Warn`, `Error`: Package-level logging functions.
- `DebugContext`, `InfoContext`, `WarnContext`, `ErrorContext`: Context-aware logging functions that extract trace IDs and other values.

[Full package docs at pkg.go.dev](https://pkg.go.dev/github.com/platforma-dev/platforma/log)

## Step-by-step guide

<Steps>

1. Use package-level logging functions

    ```go
    log.Info("server started", "port", 8080)
    log.Error("failed to connect", "error", err)
    ```

    These use the default logger which outputs text format at Info level.

    Expected output:

    ```
    time=2025-01-01T12:00:00.000+00:00 level=INFO msg="server started" port=8080
    ```

2. Use context-aware logging

    ```go
    ctx := context.WithValue(ctx, log.TraceIDKey, "abc-123")
    log.InfoContext(ctx, "processing request", "path", "/users")
    ```

    Context values from known keys are automatically added to log output.

    Expected output:

    ```
    time=2025-01-01T12:00:00.000+00:00 level=INFO msg="processing request" path=/users traceId=abc-123
    ```

3. Create a custom logger

    ```go
    logger := log.New(os.Stdout, "json", slog.LevelDebug, nil)
    logger.Info("message", "key", "value")
    ```

    The second argument is the format: `"text"` or `"json"`. The third is the minimum log level.

    Expected JSON output:

    ```json
    {"time":"2025-01-01T12:00:00.000+00:00","level":"INFO","msg":"message","key":"value"}
    ```

4. Set a custom default logger

    ```go
    logger := log.New(os.Stdout, "json", slog.LevelDebug, nil)
    log.SetDefault(logger)

    log.Info("now using JSON format")
    ```

    After calling `SetDefault`, all package-level functions use the new logger.

5. Add custom context keys

    ```go
    type myKey string
    const RequestIDKey myKey = "requestId"

    customKeys := map[string]any{
        "requestId": RequestIDKey,
    }
    logger := log.New(os.Stdout, "text", slog.LevelInfo, customKeys)
    log.SetDefault(logger)

    ctx := context.WithValue(ctx, RequestIDKey, "req-456")
    log.InfoContext(ctx, "custom key extracted")
    ```

    Expected output:

    ```
    time=2025-01-01T12:00:00.000+00:00 level=INFO msg="custom key extracted" requestId=req-456
    ```

</Steps>

## Built-in context keys

The logger automatically extracts these context keys when using `*Context` functions:

| Key | Description |
|-----|-------------|
| `TraceIDKey` | Request trace ID for distributed tracing |
| `ServiceNameKey` | Service identifier |
| `DomainNameKey` | Domain name for domain-based architectures |
| `StartupTaskKey` | Startup task name during application initialization |
| `UserIDKey` | Authenticated user ID |
| `WorkerIDKey` | Queue processor worker ID |

## Using with Application

The `application` package and other Platforma components automatically set context keys like `ServiceNameKey` and `StartupTaskKey`. Use context-aware logging to include this information:

```go
app := application.New()

app.OnStart(application.StartupTask{
    Name: "init-cache",
    Task: func(ctx context.Context, config any) error {
        log.InfoContext(ctx, "initializing cache")
        // startupTask=init-cache automatically added to output
        return nil
    },
}, nil)

app.Run(ctx)
```

With `httpserver.TraceIDMiddleware`, the trace ID is automatically available in request handlers:

```go
server := httpserver.New("8080", 3*time.Second)
server.Use(httpserver.NewTraceIDMiddleware(nil, ""))

server.HandleFunc("/users", func(w http.ResponseWriter, r *http.Request) {
    log.InfoContext(r.Context(), "handling request")
    // traceId=<uuid> automatically added to output
})
```

## Complete example

```go
package main

import (
	"context"
	"log/slog"
	"net/http"
	"os"
	"time"

	"github.com/platforma-dev/platforma/application"
	"github.com/platforma-dev/platforma/httpserver"
	"github.com/platforma-dev/platforma/log"
)

func main() {
	ctx := context.Background()

	// Configure JSON logging at Debug level
	logger := log.New(os.Stdout, "json", slog.LevelDebug, nil)
	log.SetDefault(logger)

	app := application.New()

	server := httpserver.New("8080", 3*time.Second)
	server.Use(httpserver.NewTraceIDMiddleware(nil, ""))

	server.HandleFunc("/ping", func(w http.ResponseWriter, r *http.Request) {
		log.InfoContext(r.Context(), "ping received")
		w.Write([]byte("pong"))
	})

	app.RegisterService("api", server)

	if err := app.Run(ctx); err != nil {
		log.ErrorContext(ctx, "app finished with error", "error", err)
	}
}
```
